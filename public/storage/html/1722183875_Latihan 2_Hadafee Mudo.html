<p>let imageFiles = [];</p>
<p>// ฟังก์ชันสำหรับแสดงภาพพรีวิว<br>function previewImages(event) {<br>&nbsp; &nbsp; const files = event.target.files;<br>&nbsp; &nbsp; const preview = document.getElementById('image-preview');</p>
<p>&nbsp; &nbsp; Array.from(files).forEach(file =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!imageFiles.some(existingFile =&gt; existingFile.name === file.name &amp;&amp; existingFile.size === file.size)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imageFiles.push(file);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const reader = new FileReader();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reader.onload = function(e) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const imgContainer = document.createElement('div');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imgContainer.style.position = 'relative';</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const img = document.createElement('img');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; img.src = e.target.result;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; img.alt = 'Image Preview';</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const removeIcon = document.createElement('span');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; removeIcon.className = 'remove-icon';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; removeIcon.innerHTML = '&amp;times;';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; removeIcon.onclick = function() {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const index = imageFiles.indexOf(file);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (index &gt; -1) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imageFiles.splice(index, 1);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imgContainer.remove();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imgContainer.appendChild(img);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imgContainer.appendChild(removeIcon);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; preview.appendChild(imgContainer);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reader.readAsDataURL(file);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; });</p>
<p>&nbsp; &nbsp; event.target.value = '';<br>}</p>
<p>// ฟังก์ชันสำหรับแสดงภาพพรีวิวในฟอร์มตอบกลับ<br>function previewImages2(event) {<br>&nbsp; &nbsp; const id = event.target.id.split('-')[2]; // แยก id ของคอมเม้น<br>&nbsp; &nbsp; const files = event.target.files;<br>&nbsp; &nbsp; const preview = document.getElementById('image-preview-' + id);</p>
<p>&nbsp; &nbsp; Array.from(files).forEach(file =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (!imageFiles.some(existingFile =&gt; existingFile.name === file.name &amp;&amp; existingFile.size === file.size)) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imageFiles.push(file);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const reader = new FileReader();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reader.onload = function(e) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const imgContainer = document.createElement('div');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imgContainer.style.position = 'relative';</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const img = document.createElement('img');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; img.src = e.target.result;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; img.alt = 'Image Preview';</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const removeIcon = document.createElement('span');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; removeIcon.className = 'remove-icon';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; removeIcon.innerHTML = '&amp;times;';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; removeIcon.onclick = function() {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const index = imageFiles.indexOf(file);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (index &gt; -1) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imageFiles.splice(index, 1);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imgContainer.remove();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imgContainer.appendChild(img);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imgContainer.appendChild(removeIcon);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; preview.appendChild(imgContainer);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; };<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reader.readAsDataURL(file);<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; });</p>
<p>&nbsp; &nbsp; event.target.value = '';<br>}</p>
<p>// ฟังก์ชันสำหรับส่งฟอร์มคอมเม้น<br>function submitForm() {<br>&nbsp; &nbsp; const form = document.getElementById('comment-form');<br>&nbsp; &nbsp; const formData = new FormData(form);<br>&nbsp; &nbsp; const commentInput = form.querySelector('textarea[name="isi_komentar"]').value.trim();<br>&nbsp; &nbsp; const maxFileSize = 2048 * 1024; // ขนาดไฟล์สูงสุดในหน่วย bytes (2048 KB)<br>&nbsp; &nbsp; let isValid = true;</p>
<p>&nbsp; &nbsp; // ตรวจสอบว่ามีการเขียนคอมเม้นหรือไม่<br>&nbsp; &nbsp; if (commentInput === '') {<br>&nbsp; &nbsp; &nbsp; &nbsp; alert('กรุณาเขียนคอมเม้น');<br>&nbsp; &nbsp; &nbsp; &nbsp; isValid = false;<br>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; // ตรวจสอบขนาดไฟล์<br>&nbsp; &nbsp; imageFiles.forEach(file =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (file.size &gt; maxFileSize) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert('ไฟล์ขนาดใหญ่เกินไป กรุณาเลือกไฟล์ที่มีขนาดไม่เกิน 2 MB');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; isValid = false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; formData.append('file_komentar[]', file);<br>&nbsp; &nbsp; });</p>
<p>&nbsp; &nbsp; // หากข้อมูลถูกต้องให้ส่งฟอร์ม<br>&nbsp; &nbsp; if (isValid) {<br>&nbsp; &nbsp; &nbsp; &nbsp; fetch(form.action, {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: 'POST',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; body: formData<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .then(response =&gt; response.json())<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .then(data =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (data.success) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; form.reset();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imageFiles = [];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('image-preview').innerHTML = '';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loadComments();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .catch(error =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.error('There was a problem with the fetch operation:', error);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });<br>&nbsp; &nbsp; }<br>}</p>
<p>// ฟังก์ชันสำหรับส่งฟอร์มตอบกลับ<br>function submitForm2(id) {<br>&nbsp; &nbsp; const form = document.getElementById('reply-comment-form-' + id);<br>&nbsp; &nbsp; const formData = new FormData(form);<br>&nbsp; &nbsp; const commentInput = form.querySelector('textarea[name="isi_komentar"]').value.trim();<br>&nbsp; &nbsp; const maxFileSize = 2048 * 1024; // ขนาดไฟล์สูงสุดในหน่วย bytes (2048 KB)<br>&nbsp; &nbsp; let isValid = true;</p>
<p>&nbsp; &nbsp; // ตรวจสอบว่ามีการเขียนคอมเม้นหรือไม่<br>&nbsp; &nbsp; if (commentInput === '') {<br>&nbsp; &nbsp; &nbsp; &nbsp; alert('กรุณาเขียนคอมเม้น');<br>&nbsp; &nbsp; &nbsp; &nbsp; isValid = false;<br>&nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; // ตรวจสอบขนาดไฟล์<br>&nbsp; &nbsp; imageFiles.forEach(file =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; if (file.size &gt; maxFileSize) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert('ไฟล์ขนาดใหญ่เกินไป กรุณาเลือกไฟล์ที่มีขนาดไม่เกิน 2 MB');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; isValid = false;<br>&nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; formData.append('file_komentar[]', file);<br>&nbsp; &nbsp; });</p>
<p>&nbsp; &nbsp; // หากข้อมูลถูกต้องให้ส่งฟอร์ม<br>&nbsp; &nbsp; if (isValid) {<br>&nbsp; &nbsp; &nbsp; &nbsp; fetch(form.action, {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: 'POST',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; body: formData<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .then(response =&gt; response.json())<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .then(data =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (data.success) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; form.reset();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imageFiles = [];<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.getElementById('image-preview-' + id).innerHTML = '';<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loadComments();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .catch(error =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.error('There was a problem with the fetch operation:', error);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });<br>&nbsp; &nbsp; }<br>}</p>
<p>// ฟังก์ชันสำหรับโหลดคอมเม้น<br>function loadComments() {<br>&nbsp; &nbsp; const url = new URL(window.location.href);<br>&nbsp; &nbsp; url.searchParams.set('ajax', 1);<br>&nbsp; &nbsp; url.searchParams.set('sort', document.getElementById('sort-comments').value);</p>
<p>&nbsp; &nbsp; fetch(url)<br>&nbsp; &nbsp; &nbsp; &nbsp; .then(response =&gt; response.text())<br>&nbsp; &nbsp; &nbsp; &nbsp; .then(html =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const parser = new DOMParser();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const doc = parser.parseFromString(html, 'text/html');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const newComments = doc.querySelector('#comments-container');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.querySelector('#comments-container').innerHTML = newComments.innerHTML;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Re-bind rating events<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bindRatingEvents();<br>&nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; .catch(error =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.error('Error loading comments:', error);<br>&nbsp; &nbsp; &nbsp; &nbsp; });<br>}</p>
<p>// ฟังก์ชันสำหรับเปิด Image Modal<br>function openImageModal(src, index, images) {<br>&nbsp; &nbsp; currentImageIndex = index;<br>&nbsp; &nbsp; imageList = images.map(img =&gt; "{{ Storage::url('public/komentarSoal/' . $komentar-&gt;id_soal . '/') }}" + img);</p>
<p>&nbsp; &nbsp; var modal = document.getElementById("imageModal");<br>&nbsp; &nbsp; var modalImg = document.getElementById("modalImage");<br>&nbsp; &nbsp; modal.style.display = "block";<br>&nbsp; &nbsp; modalImg.src = src;<br>&nbsp; &nbsp; modalImg.style.maxWidth = "80%";<br>&nbsp; &nbsp; modalImg.style.maxHeight = "80vh";<br>}</p>
<p>// ฟังก์ชันสำหรับปิด Image Modal<br>function closeImageModal() {<br>&nbsp; &nbsp; var modal = document.getElementById("imageModal");<br>&nbsp; &nbsp; modal.style.display = "none";<br>}</p>
<p>// ฟังก์ชันสำหรับเปลี่ยนภาพใน Image Modal<br>function changeImage(direction) {<br>&nbsp; &nbsp; currentImageIndex += direction;<br>&nbsp; &nbsp; if (currentImageIndex &lt; 0) {<br>&nbsp; &nbsp; &nbsp; &nbsp; currentImageIndex = imageList.length - 1;<br>&nbsp; &nbsp; } else if (currentImageIndex &gt;= imageList.length) {<br>&nbsp; &nbsp; &nbsp; &nbsp; currentImageIndex = 0;<br>&nbsp; &nbsp; }<br>&nbsp; &nbsp; var modalImg = document.getElementById("modalImage");<br>&nbsp; &nbsp; modalImg.src = imageList[currentImageIndex];<br>}</p>
<p>// ฟังก์ชันสำหรับแสดงฟอร์มตอบกลับ<br>function showReplyForm(komentarId) {<br>&nbsp; &nbsp; document.querySelectorAll('.reply-form').forEach(form =&gt; form.style.display = 'none');<br>&nbsp; &nbsp; document.getElementById('reply-form-' + komentarId).style.display = 'block';<br>}</p>
<p>// ฟังก์ชันสำหรับ Bind เหตุการณ์การให้คะแนน<br>function bindRatingEvents() {<br>&nbsp; &nbsp; document.querySelectorAll('.rating span').forEach(star =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; star.addEventListener('click', function() {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let rating = this.getAttribute('data-rating');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let komentarId = this.parentNode.getAttribute('data-komentar-id');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let stars = this.parentNode.children;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let i = 0; i &lt; stars.length; i++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (i &lt; rating) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stars[i].classList.add('selected');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stars[i].classList.remove('selected');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fetch('{{ route("submit.rating") }}', {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: 'POST',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; headers: {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Content-Type': 'application/json',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'X-CSRF-TOKEN': '{{ csrf_token() }}'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; },<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; body: JSON.stringify({<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; id_komentar: komentarId,<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rating: rating<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .then(response =&gt; response.json())<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .then(data =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (data.success) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const avgRatingElement = document.querySelector(`.avg_rating[data-komentar-id="${data.komentar_id}"]`);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; avgRatingElement.querySelector('span:nth-child(2)').textContent = data.avg_rating;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; avgRatingElement.querySelector('span:nth-child(3)').textContent = `(${data.rating_count})`;</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // รีเฟรช rightcolumn<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loadComments();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .catch(error =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.error('Error:', error);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });<br>&nbsp; &nbsp; &nbsp; &nbsp; });</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; star.addEventListener('mouseover', function() {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let rating = this.getAttribute('data-rating');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let stars = this.parentNode.children;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let i = 0; i &lt; stars.length; i++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (i &lt; rating) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stars[i].classList.add('hover');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stars[i].classList.remove('hover');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; });</p>
<p>&nbsp; &nbsp; &nbsp; &nbsp; star.addEventListener('mouseout', function() {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; let stars = this.parentNode.children;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for (let i = 0; i &lt; stars.length; i++) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; stars[i].classList.remove('hover');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; });<br>&nbsp; &nbsp; });<br>}</p>
<p>document.addEventListener('DOMContentLoaded', function() {<br>&nbsp; &nbsp; bindRatingEvents();<br>});</p>
<p>// ฟังก์ชันสำหรับจัดเรียงคอมเม้น<br>function sortComments() {<br>&nbsp; &nbsp; const sortOption = document.getElementById('sort-comments').value;<br>&nbsp; &nbsp; const url = new URL(window.location.href);<br>&nbsp; &nbsp; url.searchParams.set('sort', sortOption);<br>&nbsp; &nbsp; url.searchParams.set('ajax', 1);</p>
<p>&nbsp; &nbsp; fetch(url)<br>&nbsp; &nbsp; &nbsp; &nbsp; .then(response =&gt; response.text())<br>&nbsp; &nbsp; &nbsp; &nbsp; .then(html =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const parser = new DOMParser();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const doc = parser.parseFromString(html, 'text/html');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; const newRightColumn = doc.querySelector('#rightcolumn');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; document.querySelector('#rightcolumn').innerHTML = newRightColumn.innerHTML;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bindRatingEvents();<br>&nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; .catch(error =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.error('Error sorting comments:', error);<br>&nbsp; &nbsp; &nbsp; &nbsp; });<br>}</p>
<p>// ฟังก์ชันสำหรับลบคอมเม้น<br>function deleteComment(commentId) {<br>&nbsp; &nbsp; if (confirm('คุณต้องการลบคอมเม้นนี้หรือไม่?')) {<br>&nbsp; &nbsp; &nbsp; &nbsp; fetch(`/komentar/${commentId}`, {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; method: 'DELETE',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; headers: {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'X-CSRF-TOKEN': '{{ csrf_token() }}',<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 'Content-Type': 'application/json'<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; .then(response =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (!response.ok) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new Error('Network response was not ok');<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return response.json();<br>&nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; .then(data =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (data.success) {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; loadComments();<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert('เกิดข้อผิดพลาดในการลบคอมเม้น: ' + data.message);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br>&nbsp; &nbsp; &nbsp; &nbsp; })<br>&nbsp; &nbsp; &nbsp; &nbsp; .catch(error =&gt; {<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; console.error('Error:', error);<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; alert('เกิดข้อผิดพลาดในการลบคอมเม้น: ' + error.message);<br>&nbsp; &nbsp; &nbsp; &nbsp; });<br>&nbsp; &nbsp; }<br>}<br>&lt;/script&gt;<br>@endsection</p>